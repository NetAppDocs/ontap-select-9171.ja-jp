---
sidebar: sidebar 
permalink: concept_ha_mirroring.html 
keywords: ontap select, ha, high availability, synchronous replication, mirrored aggregates, write path, raid syncmirror, rsm 
summary: 'RAID SyncMirror (RSM)、ミラー化されたアグリゲート、および書き込みパスを使用してデータ損失を防ぎます。' 
---
= ONTAP Select HA RSMとミラーリングされたアグリゲート
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
RAID SyncMirror (RSM)、ミラー化されたアグリゲート、および書き込みパスを使用してデータ損失を防ぎます。



== 同期レプリケーション

ONTAP HAモデルは、HAパートナーの概念に基づいて構築されています。ONTAPONTAP Selectは、 ONTAPに搭載されているRAID SyncMirror （RSM）機能を使用してクラスタノード間でデータブロックを複製することで、このアーキテクチャを非共有型コモディティサーバの世界に拡張し、HAペアに分散されたユーザーデータの2つのコピーを提供します。

メディエータを備えた2ノードクラスタは、2つのデータセンターにまたがって構成できます。詳細については、セクションをご覧ください。link:reference_plan_best_practices.html#two-node-stretched-ha-metrocluster-sds-best-practices["2ノードストレッチHA（MetroCluster SDS）のベストプラクティス"] 。



== ミラーリングされたアグリゲート

ONTAP Selectクラスタは2～8ノードで構成されます。各HAペアにはユーザーデータのコピーが2つ含まれ、IPネットワークを介してノード間で同期的にミラーリングされます。このミラーリングはユーザーにとって透過的であり、データアグリゲートのプロパティとして、データアグリゲートの作成プロセス中に自動的に設定されます。

ONTAP Selectクラスタ内のすべてのアグリゲートは、ノードフェイルオーバー時のデータ可用性を確保し、ハードウェア障害発生時のSPOFを回避するためにミラーリングする必要があります。ONTAPONTAP Selectクラスタ内のアグリゲートは、HAペアの各ノードから提供される仮想ディスクから構築され、以下のディスクを使用します。

* ローカルのディスク セット（現在のONTAP Selectノードによって提供される）
* ミラーリングされたディスク セット (現在のノードの HA パートナーによって提供される)



NOTE: ミラーリングされたアグリゲートの構築に使用するローカルディスクとミラーディスクは、同じサイズである必要があります。これらのアグリゲートは、それぞれローカルミラーペアとリモートミラーペアを示すプレックス0とプレックス1と呼ばれます。実際のプレックス番号は、インストール環境によって異なる場合があります。

このアプローチは、標準的なONTAPクラスタの動作とは根本的に異なります。これは、 ONTAP Selectクラスタ内のすべてのルートディスクとデータディスクに適用されます。アグリゲートには、データのローカルコピーとミラーコピーの両方が含まれます。したがって、N個の仮想ディスクを含むアグリゲートは、N/2ディスク分の固有のストレージを提供します。これは、データの2番目のコピーがそれぞれ固有のディスク上に存在するためです。

次の図は、4ノードのONTAP Selectクラスタ内のHAペアを示しています。このクラスタ内には、両方のHAパートナーのストレージを使用する単一のアグリゲート（テスト）があります。このデータアグリゲートは、2つの仮想ディスクセットで構成されています。1つはONTAP Selectを所有するクラスタノード（Plex 0）が提供するローカルセット、もう1つはフェイルオーバーパートナー（Plex 1）が提供するリモートセットです。

Plex 0はすべてのローカルディスクを保持するバケットです。Plex1はミラーディスク、つまりユーザーデータの2番目の複製コピーを格納するディスクを保持するバケットです。アグリゲートを所有するノードはPlex 0にディスクを提供し、そのノードのHAパートナーはPlex 1にディスクを提供します。

次の図には、2つのディスクを持つミラーリングされたアグリゲートがあります。このアグリゲートの内容は2つのクラスタノード間でミラーリングされており、ローカルディスクNET-1.1はPlex 0バケットに、リモートディスクNET-2.1はPlex 1バケットに配置されています。この例では、アグリゲートtestは左側のクラスタノードに所有されており、ローカルディスクNET-1.1とHAパートナーミラーディスクNET-2.1を使用しています。

* ONTAP Selectミラーリングされたアグリゲート*image:DDHA_03.jpg["ONTAP Selectミラーアグリゲート"]


NOTE: ONTAP Selectクラスタを導入すると、システム上のすべての仮想ディスクが適切なプレックスに自動的に割り当てられるため、ユーザーがディスク割り当てに関して追加の手順を踏む必要はありません。これにより、ディスクが誤ったプレックスに誤って割り当てられるのを防ぎ、最適なミラーディスク構成を実現します。



== 書き込みパス

クラスタノード間のデータブロックの同期ミラーリングと、システム障害発生時のデータ損失ゼロという要件は、 ONTAP Selectクラスタ内での書き込みパスに大きな影響を与えます。このプロセスは2つの段階から構成されます。

* 了承
* デステージング


ターゲットボリュームへの書き込みはデータLIFを介して行われ、 ONTAP Selectノードのシステムディスク上にある仮想NVRAMパーティションにコミットされた後、クライアントに確認応答が返されます。HA構成では、これらのNVRAMへの書き込みは確認応答される前に、ターゲットボリュームの所有者のHAパートナーに即座にミラーリングされるため、追加のステップが発生します。このプロセスにより、元のノードでハードウェア障害が発生した場合でも、HAパートナーノード上のファイルシステムの整合性が確保されます。

書き込みがNVRAMにコミットされた後、 ONTAPは定期的にこのパーティションの内容を適切な仮想ディスクに移動します。このプロセスはデステージングと呼ばれます。このプロセスは、ターゲットボリュームを所有するクラスタノードで一度だけ実行され、HAパートナーでは実行されません。

次の図は、ONTAP Selectノードへの着信書き込み要求の書き込みパスを示しています。

* ONTAP Select書き込みパスワークフロー*image:DDHA_04.jpg["ONTAP Select書き込みパスワークフロー"]

着信書き込み確認には次の手順が含まれます。

* 書き込みは、ONTAP Selectノード A が所有する論理インターフェイスを介してシステムに入ります。
* 書き込みはノード A のNVRAMにコミットされ、HA パートナーであるノード B にミラーリングされます。
* I/O 要求が両方の HA ノードに存在すると、その要求はクライアントに確認応答されます。


NVRAMからデータ アグリゲート (ONTAP CP) へのONTAP Selectデステージングには、次の手順が含まれます。

* 書き込みは仮想NVRAMから仮想データ アグリゲートにデステージされます。
* ミラー エンジンは、ブロックを両方のプレックスに同期的に複製します。

