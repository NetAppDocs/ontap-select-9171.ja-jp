---
sidebar: sidebar 
permalink: concept_nw_vsphere_vswitch_config.html 
keywords: ontap select, standard and distributed vSwitch configurations, vSwitch configuration and load-balancing policies 
summary: 2 つの NIC 構成と 4 つの NIC 構成のONTAP Select vSwitch 構成と負荷分散ポリシー。 
---
= ESXi 上のONTAP Select VMware vSphere vSwitch 構成
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
2 つの NIC 構成と 4 つの NIC 構成のONTAP Select vSwitch 構成と負荷分散ポリシー。

ONTAP Selectは、標準vSwitch構成と分散vSwitch構成の両方をサポートしています。分散vSwitchは、リンクアグリゲーション（LACP）構造をサポートしています。リンクアグリゲーションは、複数の物理アダプタ間で帯域幅を集約するために使用される一般的なネットワーク構造です。LACPは、物理ネットワークポートのグループを単一の論理チャネルにバンドルするネットワークエンドポイント用のオープンプロトコルを提供する、ベンダー中立の標準規格です。ONTAPONTAP Selectは、リンクアグリゲーショングループ（LAG）として設定されたポートグループと連携できます。ただし、 NetApp、LAG構成を回避するために、個々の物理ポートを単純なアップリンク（トランク）ポートとして使用することを推奨しています。これらの場合、標準vSwitchと分散vSwitchのベストプラクティスは同じです。

このセクションでは、2 つの NIC 構成と 4 つの NIC 構成の両方で使用する必要がある vSwitch 構成と負荷分散ポリシーについて説明します。

ONTAP Selectで使用するポートグループを設定する際には、以下のベストプラクティスに従う必要があります。ポートグループレベルのロードバランシングポリシーは、「発信元仮想ポート ID に基づくルート」です。VMwareVMware では、ESXi ホストに接続するスイッチ ポートの STP を Portfast に設定することを推奨しています。

すべての vSwitch 構成では、単一の NIC チームにバンドルされた少なくとも 2 つの物理ネットワーク アダプタが必要です。ONTAPONTAP Select は、 2 ノード クラスタに対して単一の 10Gb リンクをサポートします。ただし、NetAppでは、NICアグリゲーションを使用してハードウェアの冗長性を確保することをベストプラクティスとして推奨します。

vSphere サーバーでは、NIC チームは複数の物理ネットワークアダプタを単一の論理チャネルにまとめるために使用される集約構造であり、これによりネットワーク負荷をすべてのメンバーポート間で分散できます。NICチームは物理スイッチのサポートなしでも作成できることを覚えておくことが重要です。ロードバランシングおよびフェイルオーバーポリシーは、上流のスイッチ構成を認識せずに NIC チームに直接適用できます。この場合、ポリシーは送信トラフィックにのみ適用されます。


NOTE: 静的ポート チャネルはONTAP Selectではサポートされません。LACP対応チャネルは分散 vSwitch でサポートされますが、LACP LAG を使用すると、LAG メンバー間で負荷分散が不均一になる可能性があります。

シングルノードクラスタの場合、 ONTAP Deployは、ONTAP Select VMが外部ネットワーク用のポートグループを使用し、クラスタとノードの管理トラフィック用に同じポートグループ、またはオプションで別のポートグループを使用するように設定します。シングルノードクラスタでは、必要な数の物理ポートをアクティブアダプタとして外部ポートグループに追加できます。

マルチノードクラスタの場合、 ONTAP Deployは各ONTAP Select VMを、内部ネットワーク用に1つまたは2つのポートグループを使用し、外部ネットワーク用に1つまたは2つのポートグループを別々に使用するように設定します。クラスタとノードの管理トラフィックは、外部トラフィックと同じポートグループを使用することも、オプションで別のポートグループを使用することもできます。クラスタとノードの管理トラフィックは、内部トラフィックと同じポートグループを共有することはできません。


NOTE: ONTAP Select は最大 4 つの VMNIC をサポートします。



== 標準または分散vSwitchとノードあたり4つの物理ポート

マルチノードクラスタ内の各ノードには、4つのポートグループを割り当てることができます。各ポートグループには、次の図に示すように、1つのアクティブ物理ポートと3つのスタンバイ物理ポートが含まれます。

*ノードあたり4つの物理ポートを備えたvSwitch*

image:DDN_08.jpg["ノードごとに4つの物理ポートを備えたvSwitch"]

スタンバイリスト内のポートの順序は重要です。次の表は、4つのポートグループにおける物理ポートの分散例を示しています。

*ネットワークの最小構成と推奨構成*

[cols="5*"]
|===
| ポートグループ | 外部1 | 外部2 | 内部1 | 内部2 


| アクティブ | vmnic0 | vmnic1 | vmnic2 | vmnic3 


| スタンバイ1 | vmnic1 | vmnic0 | vmnic3 | vmnic2 


| スタンバイ2 | vmnic2 | vmnic3 | vmnic0 | vmnic1 


| スタンバイ3 | vmnic3 | vmnic2 | vmnic1 | vmnic0 
|===
次の図は、vCenter UI からの外部ネットワーク ポート グループ（ONTAP-External およびONTAP-External2）の設定を示しています。アクティブなアダプタは異なるネットワーク カードに接続されていることに注意してください。この設定では、vmnic 4 と vmnic 5 は同じ物理 NIC 上のデュアル ポートであり、vmnic 6 と vmnic 7 は同様に別の NIC 上のデュアル ポートです（この例では、vnmics 0 ～ 3 は使用されていません）。スタンバイ アダプタの順序により、内部ネットワークのポートが最後に表示される階層的なフェイルオーバーが実現されます。スタンバイ リスト内の内部ポートの順序も、2 つの外部ポート グループ間で同様に入れ替わっています。

*パート1: ONTAP Select外部ポートグループの構成*

image:DDN_09.jpg["パート1： ONTAP Select外部ポートグループの設定"]

*パート2: ONTAP Select外部ポートグループの構成*

image:DDN_10.jpg["パート2： ONTAP Select外部ポートグループの設定"]

読みやすくするために、割り当ては次のようになります。

[cols="2*"]
|===
| ONTAP-外部 | ONTAP-外部2 


| アクティブアダプタ: vmnic5 スタンバイアダプタ: vmnic7、vmnic4、vmnic6 | アクティブアダプタ: vmnic7 スタンバイアダプタ: vmnic5、vmnic6、vmnic4 
|===
次の図は、内部ネットワーク ポート グループ（ONTAP-Internal およびONTAP-Internal2）の構成を示しています。アクティブなアダプタは異なるネットワーク カードに接続されていることに注意してください。この設定では、vmnic 4 と vmnic 5 は同じ物理 ASIC 上のデュアル ポートであり、vmnic 6 と vmnic 7 は同様に別の ASIC 上のデュアル ポートです。スタンバイ アダプタの順序により、外部ネットワークからのポートが最後に配置される階層的なフェイルオーバーが実現されます。スタンバイ リスト内の外部ポートの順序も同様に、2 つの内部ポート グループ間で入れ替わっています。

*パート1: ONTAP Select内部ポートグループ構成*

image:DDN_11.jpg["パート1： ONTAP Select内部ポートグループ構成"]

*パート2: ONTAP Select内部ポートグループ*

image:DDN_12.jpg["パート2： ONTAP Select内部ポートグループ"]

読みやすくするために、割り当ては次のようになります。

[cols="2*"]
|===
| ONTAP-内部 | ONTAP-内部2 


| アクティブアダプタ: vmnic4 スタンバイアダプタ: vmnic6、vmnic5、vmnic7 | アクティブアダプタ: vmnic6 スタンバイアダプタ: vmnic4、vmnic7、vmnic5 
|===


== 標準または分散vSwitchとノードあたり2つの物理ポート

高速（25/40Gb）NICを2枚使用する場合、推奨されるポートグループ構成は、概念的には10Gbアダプタを4枚使用する場合の構成と非常に似ています。物理アダプタを2枚しか使用しない場合でも、4つのポートグループを使用する必要があります。ポートグループの割り当ては以下のとおりです。

[cols="5*"]
|===
| ポートグループ | 外部1 (e0a,e0b) | 内部1 (e0c,e0e) | 内部2 (e0d,e0f) | 外部2（e0g） 


| アクティブ | vmnic0 | vmnic0 | vmnic1 | vmnic1 


| Standby | vmnic1 | vmnic1 | vmnic0 | vmnic0 
|===
*ノードあたり2つの高速（25/40Gb）物理ポートを備えたvSwitch*

image:DDN_17.jpg["ノードごとに2つの高速（25/40Gb）物理ポートを備えたvSwitch"]

2つの物理ポート（10Gb以下）を使用する場合、各ポートグループには、互いに反対側にアクティブアダプタとスタンバイアダプタを設定する必要があります。内部ネットワークは、マルチノードONTAP Selectクラスタにのみ存在します。シングルノードクラスタの場合は、外部ポートグループで両方のアダプタをアクティブとして設定できます。

次の例は、マルチノードONTAP Selectクラスタの内部および外部通信サービスを処理する 1 つの vSwitch と 2 つのポートグループの構成を示しています。ネットワーク障害が発生した場合、外部ネットワークは内部ネットワークの VMNIC を使用できます。これは、内部ネットワークの VMNIC がこのポートグループに属し、スタンバイモードに設定されているためです。外部ネットワークの場合は逆の動作となります。2つのポートグループ間でアクティブ VMNIC とスタンバイ VMNIC を交互に使用することは、ネットワーク障害時にONTAP Select VM を適切にフェイルオーバーするために不可欠です。

*ノードあたり2つの物理ポート（10Gb以下）を備えたvSwitch*

image:DDN_13.jpg["ノードごとに2つの物理ポートを備えたvSwitch"]



== LACP を使用した分散 vSwitch

分散vSwitchを構成で使用する場合、ネットワーク構成を簡素化するためにLACPを使用できます（ただし、これはベストプラクティスではありません）。サポートされているLACP構成では、すべてのVMNICが単一のLAGに含まれている必要があります。アップリンク物理スイッチは、チャネル内のすべてのポートで7,500～9,000のMTUサイズをサポートする必要があります。内部および外部のONTAP Selectネットワークは、ポートグループレベルで分離する必要があります。内部ネットワークでは、ルーティング不可能な（分離された）VLANを使用する必要があります。外部ネットワークでは、VST、EST、またはVGTのいずれかを使用できます。

次の例は、LACP を使用した分散 vSwitch 構成を示しています。

*LACP使用時のLAGプロパティ*

image:DDN_14.jpg["LACP使用時のLAGプロパティ"]

*LACPが有効になっている分散vSwitchを使用した外部ポートグループ構成*

image:DDN_15.jpg["LACP が有効になっている分散 vSwitch を使用した外部ポート グループ構成"]

*LACPが有効になっている分散vSwitchを使用した内部ポートグループ構成*

image:DDN_16.jpg["LACP が有効になっている分散 vSwitch を使用した内部ポート グループ構成"]


NOTE: LACPを使用するには、上流スイッチポートをポートチャネルとして設定する必要があります。分散vSwitchでこれを有効にする前に、LACP対応ポートチャネルが正しく設定されていることを確認してください。
